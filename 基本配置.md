[TOC]

### 安装

安装过程略，注意以下两点：

1. 关闭BIOS中的安全启动
2. 分区时，要分一个 ==`/boot/efi`== 分区


### 镜像

1.配置镜像

`sudo pacman-mirrors -i -c China -m rank`

2.同步源

`sudo pacman -Syy`

3.配置AUR

```shell
sudo vim /etc/pacman.conf  # 编辑pacman.conf文件

在文件的末尾加上下面两行内容：

[archlinuxcn]
Server = https://mirrors.tuna.tsinghua.edu.cn/archlinuxcn/$arch
```

4.小彩蛋

在pacman.conf文件内找到 #Misc options，将其内容修改为：

```shell
Color
VerbosePkgLists
ILoveCandy
```
5.再次同步源

`sudo pacman -Syy`

6.导入GPG key

`sudo pacman -S archlinuxcn-keyring`

7.更新系统

`sudo pacman -Syyu`


### 软件

#### 开发包

```shell
sudo pacman -S --needed base-devel  # 必须安装,不然 makepkg会提示错误
sudo pacman -S yay                  # 从 Aur 中安装软件
sudo pacman -S jre8-openjdk         # 安装完执行 source /etc/profile.d/jre.sh
```

#### 字体

```shell
sudo pacman -S noto-fonts-cjk noto-fonts-emoji ttf-sarasa-gothic ttf-fira-code
sudo pacman -S awesome-terminal-fonts ttf-font-awesome nerd-fonts-jetbrains-mono
sudo pacman -S ttf-material-design-icons-webfont
```

安装完字体后刷新字库

``fc-cache -f -v``


#### i3相关

```shell
sudo pacman -S alacritty                   # GPU驱动的终端
sudo pacman -S polybar                     # bar
sudo pacman -S rofi                        # 启动器
```

#### 常用

```shell
yay -S google-chrome                                  # 浏览器
sudo pacman -S gimp inkscape                          # 图片处理
sudo pacman -S android-tools android-udev             # 刷机用的
sudo pacman -S simplescreenrecorder peek flameshot    # 录屏、截图
sudo pacman -S screenkey                              # 按键回显
sudo pacman -S gvim code typora                       # 编辑器
sudo pacman -S transmission-gtk motrix                # 下载
sudo pacman -S unrar xarchiver gtkhash                # 压缩与校验
sudo pacman -S v2ray-desktop                          # 科学上网
sudo pacman -S gparted ventoy                         # 磁盘管理、启动盘制作
sudo pacman -S gufw                                   # 防火墙启动防火墙 sudo ufw enable
sudo pacman -S joplin-desktop                         # 笔记
sudo pacman -S variety                                # 壁纸切换软件
sudo pacman -S font-manager doublecmd-gtk2            # 字体管理器
sudo pacman -S libreoffice                            # 办公软件
sudo pacman -S zathura zathura-pdf-poppler            # PDF阅读器
sudo pacman -S timeshift                              # 系统备份
sudo pacman -S manjaro-settings-manager               # manjaro系统设置工具
```

#### cli 工具

```shell
sudo pacman -S tmux         #
sudo pacman -S net-tools    # 网络工具包
sudo pacman -S ctags        # 
sudo pacman -S shellcheck   # shell语法检查工具
sudo pacman -S httpie       # 替代curl
sudo pacman -S neofetch     # 显示系统相关信息的小工具
sudo pacman -S fortune-mod cowsay # 娱乐工具
sudo pacman -S sl cmatrix   # 娱乐工具
yay tty-clock               # 娱乐工具

# fd: 替换 find 的查找工具
# ripgrep: grep 更高速的正则匹配工具
# bat: 替换 cat 的文件内容查看工具
# exa: 替换 ls
# jq : 命令行下查看 json 文件a

yay -S code-minimap # vim 代码地图
yay -S fd bat exa jq  tldr lolcat
```

#### 娱乐

```shell
sudo pacman -S ffmpeg ffmpegthumbnailer               # 解码工具
sudo pacman -S mpv                                    # 视频播放器
sudo pacman -S mpd mpc ncmpcpp                        # 音乐播放器
```

复制配置文件到 ~/.config 目录下

之后把 mpd 和 ncmpcpp 配置里面的音乐目录改成你的音乐路径即可
```
systemctl start mpd.service --user # 启动mpd服务
systemctl enable mpd.service --user # 当然你也可以设置成自动启动
```

之后启动ncmpcpp

出现问题之后首先检查mpd的日志

`systemctl status mpd --user`

根据不同的提示来解决问题

如果没有声音，首先检查一下pulseaudio，用pulseaudio的GUI配置工具pavucontrol即可


#### 输入法

1. 安装

```shell
sudo pacman -S fcitx5-im
sudo pacman -S fcitx5-chinese-addons fcitx5-pinyin-zhwiki # 拼音
sudo pacman -S fcitx5-material-color
```

2. 配置

使用 echo ${XDG_SESSION_TYPE} 命令查看是x11, 还是wayland

vim ~/.xprofile # 编辑 .xprofile 文件

```shell
# 在文件中加入以下代码
export GTK_IM_MODULE=fcitx5
export QT_IM_MODULE=fcitx5
export XMODIFIERS=@im=fcitx5
```

wayland 编辑 `~/.pam_environment`，没有则创建

```shell
GTK_IM_MODULE=fcitx5
QT_IM_MODULE=fcitx5
XMODIFIERS=@im=fcitx5
```

3. 美化

修改配置文件 ~/.config/fcitx5/conf/classicui.conf：
```
Vertical Candidate List=False # 垂直候选列表
PerScreenDPI=True # 按屏幕 DPI 使用
Font="思源黑体 CN Medium 13" # Font (设置成你喜欢的字体)
Theme=Material-Color-Blue # 主题
PreeditInApplication=True # 单行模式
```

或者去Github下载以下主题

```
https://github.com/ayamir/fcitx5-nord
https://github.com/ayamir/fcitx5-gruvbox
```

将其复制到 `~/.local/share/fcitx5/themes`目录

**注意：修改配置文件 ~/.config/fcitx5/profile 时，请务必退出 fcitx5 输入法，
否则会因为输入法退出时会覆盖配置文件导致之前的修改被覆盖；修改其他配置文件可以不用退出 fcitx5 输入法.**

重启后生效

#### 网络分析

1. 安装

`sudo pacman -S wireshark-qt  nmap zmap`

2. 配置

```shell

# 添加wireshark用户组
# sudo groupadd  wireshark

#将dumpcap更改为wireshark用户组
sudo chgrp wireshark /usr/bin/dumpcap

#让wireshark用户组有root权限使用dumpcap
sudo chmod 4755 /usr/bin/dumpcap

#将需要使用的用户加入wireshark用户组
sudo gpasswd -a $USER wireshark
```

### 配置

#### 1.修改目录名为英文

安装 xdg-user-dirs-gtk

`sudo pacman -S xdg-user-dirs-gtk`

安装完成后，在终端依次执行下面的命令：

```shell
export LANG=en_US
xdg-user-dirs-gtk-update #执行完这步，会弹出来一个对话框，选择更新即可
export LANG=zh_CN.UTF-8
```
命令执行完成后注销或重启系统即可

#### 2.修改DPI

`vim ~/.Xresources ` # 终端执行此命令

将 `Xft.dpi`的值修改为 `120`

然后执行 `xrdb ~/.Xresources &`


#### 配置zsh

manjaro 默认安装了 zsh 和 powerleve10k 主题,不需要再安装 `oh-my-zsh`(主要太慢了)

1. 切换shell

`chsh -s /bin/zsh`   # 提示输入密码，然后注销重登陆即可

2. 安装插件

```
sudo pacman -S starship # 提示符美化
yay -S zsh-z-git        # 快速跳转
```

3. 修改 .zshrc 文件，加入以下内容

```
source /usr/share/zsh/plugins/zsh-z/zsh-z.plugin.zsh
bindkey ',' autosuggest-accept       #   使用逗号补全
```

4. 重载文件

`source .zshrc`

#### 蓝牙配置

`sudo pacman -S bluez bluez-utils blueman` # 安装软件

启动服务

```shell
sudo systemctl start bluetooth
sudo systemctl enable bluetooth 
```

然后打开 `blueman`设置即可

**蓝牙耳机已连接但是没有声音**

`sudo pacman -S pulseaudio-bluetooth pavucontrol pulseaudio-alsa` # 安装这些软件

启动pulseaudio服务

```shell
pulseaudio -k                      # 确保没有pulseaudio启动
pulseaudio --start                 # 启动pulseaudio服务
systemctl enable pulseaudio --user
```

重新启动蓝牙服务

`sudo systemctl restart bluetooth`

到蓝牙的设备管理器中将蓝牙耳机移除，重新连接


#### 触摸板

使用 `xinput list` # 查看设备
`xinput --disable "ETPS/2 Elantech Touchpad"` # 禁用触摸板


#### 启用 TRIM（仅 SSD）

如果你的根分区已经安装在了 SSD 上，启用 TRIM 会是你在安装 Manjaro 后需要做的一件事。
TRIM 会帮助清理 SSD 中的块，从而延长 SSD 的使用寿命。

`sudo systemctl enable fstrim.timer`


#### yay

执行以下命令修改 aururl :

`yay --aururl "https://aur.tuna.tsinghua.edu.cn" --save`

修改的配置文件位于 ~/.config/yay/config.json


### 美化

美化资源存放位置

```shell
主题存放目录 : /usr/share/themes 或 ~/.local/share/themes 或 ~/.themes
图标存放目录 : /usr/share/icons 或~/.local/share/icons 或 ~/.icons
字体存放目录 : /usr/share/fonts 或 ~/.local/share/fonts 或 ~/.fonts
```


#### tmux

```shell
git clone https://github.com/gpakosz/.tmux.git
ln -s -f .tmux/.tmux.conf
cp .tmux/.tmux.conf.local .
```

#### conky

`sudo vim /usr/bin/start_conky_maia` # 编辑此文件

修改配置文件路径

```shell
conky -c ~/.config/conky/shortcuts &&    # 修改为你的conkyrc存放位置
conky -c ~/.config/conky/system &&       # 修改为你的conkyrc存放位置
```


#### grub 美化

`sudo vim  /etc/default/grub` # 修改grub文件

```shell
GRUB_TIMEOUT_STYLE=hide        # 修改为 menu，开机显示grub引导画面
GRUB_TIMEOUT=15                # 修改为 5
GRUB_DISABLE_RECOVERY=true     # 修改为 false
```

**最后更新 grub !!!**

`sudo update-grub`

**也可以使用别人写好的脚本美化**

```shell

从下面的链接下载文件，然后执行，并重启即可

git clone https://github.com/vinceliuice/grub2-themes.git

sudo ./install.sh -t      # install Tela theme
sudo ./install.sh -r -t    # Remove Tela theme
```

其他的美化资源

```shell
McOS-themes
https://www.pling.com/p/1241688/
https://github.com/paullinuxthemer/Mc-OS-themes

MacOS sierra ct
https://www.opendesktop.org/p/1210856/#files-panel
https://github.com/zayronxio/Mojave-CT


Sierra-gtk-theme
https://www.pling.com/p/1013714/
https://github.com/vinceliuice/Sierra-gtk-theme
```

### 安装语言包

打开 ==`manjaro setting`== 安装即可


### 常见问题及解决


出现Keys错误，签名失败之类的,依次运行以下命令:

```shell
sudo rm -rf /etc/pacman.d/gnupg # 移除旧的keys

sudo pacman-key --init # 初始化pacman的keys

sudo pacman-key --populates archlinux # 加载签名的keys

sudo pacman-key -refresh-keys # 刷新升级已经签名的keys

sudo pacman -Sc # 清空并且下载新数据

sudo pacman -Syu # 更新
```



**出现无法锁定database的错误**

`sudo rm /var/lib/pacman/db.lck`
